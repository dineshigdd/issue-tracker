extends dashboard
block content     
    link(rel="stylesheet" type="text/css" href="../../styles/project.css")       
    body
    div
        h3='Your projects'
        div.project-dashboard-wrapper
            div#project-list
            ul.project-submenu
                button#add_project_btn( onclick="addProject()")='New project'
                button#delete_project_btn='Delete project'
                button#edit_project_btn='Edit project' 
        div#project-mgmt-form-wrapper    
    h2#issue-heading       
    div.issue-mgmt-wrapper
        div#issues 
        div#issue-btn-wrapper        
        div#project-issue       
                    
            script(type='text/javascript').                    
                var x = '';
                var issue = '';
                var isRefreshed = false;

                    
                    
            
                    //- localStorage.setItem("x", JSON.stringify(x));
                    //- location.reload();
                    //- x =  JSON.parse( localStorage.getItem('x') || [] );  
                    //- window.addEventListener('beforeunload', (event) => {

                            
                    //-     // Cancel the event as stated by the standard.
                    //-     event.preventDefault();
                    //-     // Chrome requires returnValue to be set.
                    //-     event.returnValue = '';
                    //-     isRefreshed = true;
                    //-     console.log("about to unload")

                    //-     setx();
                        
                    //-     }); 

                            
                    //-    var setx = document.onunload = () =>{
                            
                    //-          x =  JSON.parse( localStorage.getItem('x') || [] );  
                    //-           console.log(x)
                    //-     }
                
                

                    x =  !{JSON.stringify(project)};  
                
                    let list = '';    
                    let arrIssue = [];
                                if( x.length !== 0 ){
                                    x.forEach(element =>{    
                                    list = document.createElement('li');    
                                    const radioBtn = document.createElement("INPUT");
                                    radioBtn.setAttribute("type", "radio");
                                    radioBtn.setAttribute("value", element.project_name);
                                    radioBtn.setAttribute("name", "project_name");
                                    radioBtn.setAttribute("id", element._id );
                                  
                                    const radioBtnLabel = document.createElement("LABEL");
                                    radioBtnLabel.innerHTML = element.project_name;

                                    list.appendChild(radioBtn);
                                    list.appendChild(radioBtnLabel);

                                    //- list.id = `project_${element._id}`;                             
                                    //- let project_name = document.createTextNode(element.project_name);
                                    //- list.appendChild(project_name);
                                    
                                    document.getElementById('project-list').appendChild( list ); 
                                    showProjectIssues(element);
                                    
                                
                                    });
                                }
                
                    
                    function showProjectIssues(data){ 
                            document.getElementById(data._id).onclick = () => {
                                let getUrl = window.location;
                                let URL = getUrl.origin + '/api/issues/' + data._id;  
                            
                            
                                //-  window.location.href = (URL)
                                AjaxRequest('/api/issues/' + data._id, data._id);                            
                                
                            }                           
                                
                    }  
                    
                    
                    if (document.querySelector('input[name="project_name"]')) {
                            document.querySelectorAll('input[name="project_name"]').forEach((elem) => {
                                elem.addEventListener("change", function(event) {
                                let projectId = event.target.id;
                                console.log(projectId);
                                
                                document.getElementById('delete_project_btn').addEventListener('click', ()=>deleteProject(projectId) );
                                document.getElementById('edit_project_btn').addEventListener('click', ()=>updateProject(projectId) )
                            
                               

                                });
                            });
                            }
                    
                    
                    function addProject(){
                            axios.get(`/api/projects/project`).then(
                                        res => {
                                            //- document.write( res.data)
                                            document.getElementById( 'project-mgmt-form-wrapper' ).
                                                    innerHTML = res.data;
                                        
                                        }
                                    )                     
                    }

                    

                    function updateProject(id){         
                            
                             axios.get(`/api/projects/project`).then(
                                res => {
                                    document.write( res.data );
                                });

                    }
           
                    
                     


               
                