extends dashboard
block content     
    link(rel="stylesheet" type="text/css" href="../../styles/project.css")       
    body
    div
        h3='Your projects'
        div.project-dashboard-wrapper
            div#project-list
            ul.project-submenu
                li
                    a( href="#")='Delete project'
                li
                    a( href="#")='Edit project' 
            
    h2#issue-heading       
    div.issue-mgmt-wrapper
        div#issues 
        div#issue-btn-wrapper        
        div#project-issue       
                    
            script(type='text/javascript').                    
                var x = '';
                var issue = '';
                var isRefreshed = false;

                    
                    
            
                    //- localStorage.setItem("x", JSON.stringify(x));
                    //- location.reload();
                    //- x =  JSON.parse( localStorage.getItem('x') || [] );  
                    //- window.addEventListener('beforeunload', (event) => {

                            
                    //-     // Cancel the event as stated by the standard.
                    //-     event.preventDefault();
                    //-     // Chrome requires returnValue to be set.
                    //-     event.returnValue = '';
                    //-     isRefreshed = true;
                    //-     console.log("about to unload")

                    //-     setx();
                        
                    //-     }); 

                            
                    //-    var setx = document.onunload = () =>{
                            
                    //-          x =  JSON.parse( localStorage.getItem('x') || [] );  
                    //-           console.log(x)
                    //-     }
                
                

                    x =  !{JSON.stringify(project)};  
                
                    let list = '';    
                    let arrIssue = [];
                                if( x.length !== 0 ){
                                    x.forEach(element =>{    
                                    list = document.createElement('li');    
                                    const radioBtn = document.createElement("INPUT");
                                    radioBtn.setAttribute("type", "radio");
                                    radioBtn.setAttribute("value", element.project_name);
                                    radioBtn.setAttribute("name", "project_name");
                                     radioBtn.setAttribute("id", element._id );
                                    const radioBtnLabel = document.createElement("LABEL");
                                    radioBtnLabel.innerHTML = element.project_name;

                                    list.appendChild(radioBtn);
                                    list.appendChild(radioBtnLabel);

                                    //- list.id = element._id;                             
                                    //- let project_name = document.createTextNode(element.project_name);
                                    //- list.appendChild(project_name);
                                    
                                    document.getElementById('project-list').appendChild( list ); 
                                    showProjectIssues(element);
                                
                                    });
                                }
                
                    
                    function showProjectIssues(data){ 
                            document.getElementById(data._id).onclick = () => {
                                let getUrl = window.location;
                                let URL = getUrl.origin + '/api/issues/' + data._id;  
                            
                            
                                //-  window.location.href = (URL)
                                AjaxRequest('/api/issues/' + data._id, data._id);                            
                                
                            }                           
                                
                    }  
                    

            
                    const submitProject = (project) =>{      
                            
                            axios.post('/api/projects/project',project)
                                .then( res => {
                                    console.log( res.data)           
                                    
                                }).catch(error => console.log(error))
                        
                    }

            
                    const form = document.querySelector('form')
                    const formEvent = form.addEventListener('submit', event => {
                    event.preventDefault();
                
                    const project_name = document.querySelector('#projectName').value;
                    const project_description = document.querySelector('#projectDesc').value;

                    const project = { project_name , project_description };
                        
                    submitProject( project );         
                })


               
                